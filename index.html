<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>index.knit</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.14/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/rutgers.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: center, middle
background-image: url(imgs/LOGO-bigA-3101.jpg),url(imgs/cbi.png),url(imgs/logo_UT3_RVB.png)
background-position: 100% 0%,25% 100%,75% 100%
background-size: 28%,15%,20%

## .center[__Awesome visualisation with `R`__]

### .center[A journey with `ggplot2` and the `tidyverse`]

&lt;hr /&gt;

.large[Vincent ROCHER | bigA | 03/02/2022]


---

## `ggplot2` training

&lt;img src="index_files/figure-html/unnamed-chunk-1-1.svg" width="1008" style="display: block; margin: auto;" /&gt;

* Slides : https://rochevin.github.io/formation_ggplot2
* Download slides and data: https://github.com/rochevin/formation_ggplot2/archive/refs/heads/main.zip
* Compagnon wiki: https://github.com/rochevin/formation_ggplot2/wiki

---

## Why `ggplot2` instead of base plot ?


* Provide helpful commands to create complex, "almost" publication ready plots.
* Minimal changes from the data are needed to change from a barplot to a scatterplot.
* Include summary statistics (mean / median / linear regression).
* Plots are heavily customizable (even if the plot is generated by someone else).
* Heavily documented and used.
* [A lot of extensions](https://github.com/erikgahner/awesome-ggplot2).


&lt;img src="imgs/ggplot2_gallery.svg" width="100%" style="display: block; margin: auto;" /&gt;
.right[
&lt;sub&gt;[Thomas Mock (2022). Tidy Tuesday: A weekly data project aimed at the R ecosystem.](https://github.com/rfordatascience/tidytuesday)&lt;/sub&gt;
]

---

## Why `ggplot2` instead of base plot ?

.center[
&lt;img src="imgs/pfsave.svg" width="90%" /&gt;
]

---
class: center, middle
background-image: url(imgs/Tidyverse.png)
background-position: 0% 100%
background-size: 60%

.pull-right[

## R packages for data science

The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.

Install the complete tidyverse with:

```r
install.packages("tidyverse")
```

Look at the cheatsheets: https://www.rstudio.com/resources/cheatsheets/

]

---

## Tidyverse



```r
require(tidyverse)
```

```
── Attaching packages ─────────────────────────────────────────── tidyverse 1.3.1 ──
✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.7     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.0
✔ readr   2.1.2     ✔ forcats 0.5.1
── Conflicts ────────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Parts &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Tools &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Read data &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; readr &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Manipulate Data &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; dplyr/tidyr &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Plot data &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ggplot2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Customize your plots &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ggplot2 extensions &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



---

### Tidy data

&gt; __Tidying:__ structuring datasets to facilitate analysis.

A tidy dataset :

&lt;img src="imgs/tidy-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

### Why tidying a dataset ?




&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Typical presentation dataset&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; treatment_a &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; treatment_b &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; treatment_c &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; John Smith &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Jane Doe &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Mary Johnson &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;




```r
boxplot(treatments)
```

&lt;img src="index_files/figure-html/boxplot1-1.svg" width="576" style="display: block; margin: auto;" /&gt;

---

### Why tidying a dataset ?


```r
treatments.2 &lt;- t(treatments)
```


&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;The same data but structured differently&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; John Smith &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Jane Doe &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Mary Johnson &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; treatment_a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; treatment_b &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; treatment_c &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



```r
boxplot(treatments.2)
```

&lt;img src="index_files/figure-html/boxplot2-1.svg" width="576" style="display: block; margin: auto;" /&gt;



---

### Why tidying a dataset ?


```r
treatments.3 &lt;- tibble::rownames_to_column(treatments,var = "person")
treatments.3 &lt;- tidyr::pivot_longer(treatments.3,-person,names_to = "treatment",values_to = "result")
```


&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;An exemple of a tidy dataset&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; person &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; treatment &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; result &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #E41A1C !important;text-align: c;"&gt;John Smith&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #FC8D59 !important;text-align: c;"&gt;treatment_a&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;24&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #E41A1C !important;text-align: c;"&gt;John Smith&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #FFFFBF !important;text-align: c;"&gt;treatment_b&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;25&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #E41A1C !important;text-align: c;"&gt;John Smith&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #99D594 !important;text-align: c;"&gt;treatment_c&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;13&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #377EB8 !important;text-align: c;"&gt;Jane Doe&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #FC8D59 !important;text-align: c;"&gt;treatment_a&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;10&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #377EB8 !important;text-align: c;"&gt;Jane Doe&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #FFFFBF !important;text-align: c;"&gt;treatment_b&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;11&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #377EB8 !important;text-align: c;"&gt;Jane Doe&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #99D594 !important;text-align: c;"&gt;treatment_c&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;10&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #4DAF4A !important;text-align: c;"&gt;Mary Johnson&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #FC8D59 !important;text-align: c;"&gt;treatment_a&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;25&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #4DAF4A !important;text-align: c;"&gt;Mary Johnson&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #FFFFBF !important;text-align: c;"&gt;treatment_b&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;11&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #4DAF4A !important;text-align: c;"&gt;Mary Johnson&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #99D594 !important;text-align: c;"&gt;treatment_c&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: black !important;text-align: c;"&gt;21&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---

### Why tidying a dataset ?


```r
boxplot(result~treatment,data=treatments.3)
```

&lt;img src="index_files/figure-html/boxplot3-1.svg" width="576" style="display: block; margin: auto;" /&gt;

---

### Why tidying a dataset ?


```r
boxplot(result~person,data=treatments.3)
```

&lt;img src="index_files/figure-html/boxplot4-1.svg" width="576" style="display: block; margin: auto;" /&gt;

---

### Why tidying a dataset ?


```r
boxplot(result~person+treatment,data=treatments.3)
```

&lt;img src="index_files/figure-html/boxplot5-1.svg" width="576" style="display: block; margin: auto;" /&gt;

---

## Read a dataset 

&lt;img src="index_files/figure-html/unnamed-chunk-11-1.svg" width="1008" style="display: block; margin: auto;" /&gt;

---

## Read a dataset with base `R`


```r
read.table(file = "iris.tsv",sep="\t",header = T)
```

```
##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1            5.1         3.5          1.4         0.2     setosa
## 2            4.9         3.0          1.4         0.2     setosa
## 3            4.7         3.2          1.3         0.2     setosa
## 4            4.6         3.1          1.5         0.2     setosa
## 5            5.0         3.6          1.4         0.2     setosa
## 6            5.4         3.9          1.7         0.4     setosa
## 7            4.6         3.4          1.4         0.3     setosa
## 8            5.0         3.4          1.5         0.2     setosa
## 9            4.4         2.9          1.4         0.2     setosa
## 10           4.9         3.1          1.5         0.1     setosa
## 11           5.4         3.7          1.5         0.2     setosa
## 12           4.8         3.4          1.6         0.2     setosa
## 13           4.8         3.0          1.4         0.1     setosa
## 14           4.3         3.0          1.1         0.1     setosa
## 15           5.8         4.0          1.2         0.2     setosa
## 16           5.7         4.4          1.5         0.4     setosa
## 17           5.4         3.9          1.3         0.4     setosa
## 18           5.1         3.5          1.4         0.3     setosa
## 19           5.7         3.8          1.7         0.3     setosa
## 20           5.1         3.8          1.5         0.3     setosa
## 21           5.4         3.4          1.7         0.2     setosa
## 22           5.1         3.7          1.5         0.4     setosa
## 23           4.6         3.6          1.0         0.2     setosa
## 24           5.1         3.3          1.7         0.5     setosa
## 25           4.8         3.4          1.9         0.2     setosa
## 26           5.0         3.0          1.6         0.2     setosa
## 27           5.0         3.4          1.6         0.4     setosa
## 28           5.2         3.5          1.5         0.2     setosa
## 29           5.2         3.4          1.4         0.2     setosa
## 30           4.7         3.2          1.6         0.2     setosa
## 31           4.8         3.1          1.6         0.2     setosa
## 32           5.4         3.4          1.5         0.4     setosa
## 33           5.2         4.1          1.5         0.1     setosa
## 34           5.5         4.2          1.4         0.2     setosa
## 35           4.9         3.1          1.5         0.2     setosa
## 36           5.0         3.2          1.2         0.2     setosa
## 37           5.5         3.5          1.3         0.2     setosa
## 38           4.9         3.6          1.4         0.1     setosa
## 39           4.4         3.0          1.3         0.2     setosa
## 40           5.1         3.4          1.5         0.2     setosa
## 41           5.0         3.5          1.3         0.3     setosa
## 42           4.5         2.3          1.3         0.3     setosa
## 43           4.4         3.2          1.3         0.2     setosa
## 44           5.0         3.5          1.6         0.6     setosa
## 45           5.1         3.8          1.9         0.4     setosa
## 46           4.8         3.0          1.4         0.3     setosa
## 47           5.1         3.8          1.6         0.2     setosa
## 48           4.6         3.2          1.4         0.2     setosa
## 49           5.3         3.7          1.5         0.2     setosa
## 50           5.0         3.3          1.4         0.2     setosa
## 51           7.0         3.2          4.7         1.4 versicolor
## 52           6.4         3.2          4.5         1.5 versicolor
## 53           6.9         3.1          4.9         1.5 versicolor
## 54           5.5         2.3          4.0         1.3 versicolor
## 55           6.5         2.8          4.6         1.5 versicolor
## 56           5.7         2.8          4.5         1.3 versicolor
## 57           6.3         3.3          4.7         1.6 versicolor
## 58           4.9         2.4          3.3         1.0 versicolor
## 59           6.6         2.9          4.6         1.3 versicolor
## 60           5.2         2.7          3.9         1.4 versicolor
## 61           5.0         2.0          3.5         1.0 versicolor
## 62           5.9         3.0          4.2         1.5 versicolor
## 63           6.0         2.2          4.0         1.0 versicolor
## 64           6.1         2.9          4.7         1.4 versicolor
## 65           5.6         2.9          3.6         1.3 versicolor
## 66           6.7         3.1          4.4         1.4 versicolor
## 67           5.6         3.0          4.5         1.5 versicolor
## 68           5.8         2.7          4.1         1.0 versicolor
## 69           6.2         2.2          4.5         1.5 versicolor
## 70           5.6         2.5          3.9         1.1 versicolor
## 71           5.9         3.2          4.8         1.8 versicolor
## 72           6.1         2.8          4.0         1.3 versicolor
## 73           6.3         2.5          4.9         1.5 versicolor
## 74           6.1         2.8          4.7         1.2 versicolor
## 75           6.4         2.9          4.3         1.3 versicolor
## 76           6.6         3.0          4.4         1.4 versicolor
## 77           6.8         2.8          4.8         1.4 versicolor
## 78           6.7         3.0          5.0         1.7 versicolor
## 79           6.0         2.9          4.5         1.5 versicolor
## 80           5.7         2.6          3.5         1.0 versicolor
## 81           5.5         2.4          3.8         1.1 versicolor
## 82           5.5         2.4          3.7         1.0 versicolor
## 83           5.8         2.7          3.9         1.2 versicolor
## 84           6.0         2.7          5.1         1.6 versicolor
## 85           5.4         3.0          4.5         1.5 versicolor
## 86           6.0         3.4          4.5         1.6 versicolor
## 87           6.7         3.1          4.7         1.5 versicolor
## 88           6.3         2.3          4.4         1.3 versicolor
## 89           5.6         3.0          4.1         1.3 versicolor
## 90           5.5         2.5          4.0         1.3 versicolor
## 91           5.5         2.6          4.4         1.2 versicolor
## 92           6.1         3.0          4.6         1.4 versicolor
## 93           5.8         2.6          4.0         1.2 versicolor
## 94           5.0         2.3          3.3         1.0 versicolor
## 95           5.6         2.7          4.2         1.3 versicolor
## 96           5.7         3.0          4.2         1.2 versicolor
## 97           5.7         2.9          4.2         1.3 versicolor
## 98           6.2         2.9          4.3         1.3 versicolor
## 99           5.1         2.5          3.0         1.1 versicolor
## 100          5.7         2.8          4.1         1.3 versicolor
## 101          6.3         3.3          6.0         2.5  virginica
## 102          5.8         2.7          5.1         1.9  virginica
## 103          7.1         3.0          5.9         2.1  virginica
## 104          6.3         2.9          5.6         1.8  virginica
## 105          6.5         3.0          5.8         2.2  virginica
## 106          7.6         3.0          6.6         2.1  virginica
## 107          4.9         2.5          4.5         1.7  virginica
## 108          7.3         2.9          6.3         1.8  virginica
## 109          6.7         2.5          5.8         1.8  virginica
## 110          7.2         3.6          6.1         2.5  virginica
## 111          6.5         3.2          5.1         2.0  virginica
## 112          6.4         2.7          5.3         1.9  virginica
## 113          6.8         3.0          5.5         2.1  virginica
## 114          5.7         2.5          5.0         2.0  virginica
## 115          5.8         2.8          5.1         2.4  virginica
## 116          6.4         3.2          5.3         2.3  virginica
## 117          6.5         3.0          5.5         1.8  virginica
## 118          7.7         3.8          6.7         2.2  virginica
## 119          7.7         2.6          6.9         2.3  virginica
## 120          6.0         2.2          5.0         1.5  virginica
## 121          6.9         3.2          5.7         2.3  virginica
## 122          5.6         2.8          4.9         2.0  virginica
## 123          7.7         2.8          6.7         2.0  virginica
## 124          6.3         2.7          4.9         1.8  virginica
## 125          6.7         3.3          5.7         2.1  virginica
## 126          7.2         3.2          6.0         1.8  virginica
## 127          6.2         2.8          4.8         1.8  virginica
## 128          6.1         3.0          4.9         1.8  virginica
## 129          6.4         2.8          5.6         2.1  virginica
## 130          7.2         3.0          5.8         1.6  virginica
## 131          7.4         2.8          6.1         1.9  virginica
## 132          7.9         3.8          6.4         2.0  virginica
## 133          6.4         2.8          5.6         2.2  virginica
## 134          6.3         2.8          5.1         1.5  virginica
## 135          6.1         2.6          5.6         1.4  virginica
## 136          7.7         3.0          6.1         2.3  virginica
## 137          6.3         3.4          5.6         2.4  virginica
## 138          6.4         3.1          5.5         1.8  virginica
## 139          6.0         3.0          4.8         1.8  virginica
## 140          6.9         3.1          5.4         2.1  virginica
## 141          6.7         3.1          5.6         2.4  virginica
## 142          6.9         3.1          5.1         2.3  virginica
## 143          5.8         2.7          5.1         1.9  virginica
## 144          6.8         3.2          5.9         2.3  virginica
## 145          6.7         3.3          5.7         2.5  virginica
## 146          6.7         3.0          5.2         2.3  virginica
## 147          6.3         2.5          5.0         1.9  virginica
## 148          6.5         3.0          5.2         2.0  virginica
## 149          6.2         3.4          5.4         2.3  virginica
## 150          5.9         3.0          5.1         1.8  virginica
```

---

## Read a dataset with base `R`

* Return a `data.frame` object.
* `read.csv`, `read.csv2`, `read.delim` can also be used.
* Cannot read `.xsl` files (we have to use another package).

---

## Read a dataset with `readr`


```r
read_tsv(file = "iris.tsv")
```

```
## # A tibble: 150 × 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  
##  1          5.1         3.5          1.4         0.2 setosa 
##  2          4.9         3            1.4         0.2 setosa 
##  3          4.7         3.2          1.3         0.2 setosa 
##  4          4.6         3.1          1.5         0.2 setosa 
##  5          5           3.6          1.4         0.2 setosa 
##  6          5.4         3.9          1.7         0.4 setosa 
##  7          4.6         3.4          1.4         0.3 setosa 
##  8          5           3.4          1.5         0.2 setosa 
##  9          4.4         2.9          1.4         0.2 setosa 
## 10          4.9         3.1          1.5         0.1 setosa 
## # … with 140 more rows
```

---

## Read a dataset with `readr`

* Return a `tibble` object.
* `read_csv`, `read_csv2`, `read_table` can also be used.
* `.xsl` files are managed by `readxl`, an other tidyverse package (not loaded by default). 

---

###Tibbles: `tibble::tibble()`

__Pros: __

* Cells can contain list and data.frame.
* It never changes an input’s type (i.e., no more `stringsAsFactors = FALSE`!).
* Can use not valid R variable names (`:)`) as column names.
* Refined print method that shows only the first 10 rows.


__Cons: __

* It never uses `row.names()`.
    * use `tibble::rownames_to_column()`.
---

## Data manipulation with `dplyr` and `tidyr`

&lt;img src="index_files/figure-html/unnamed-chunk-14-1.svg" width="1008" style="display: block; margin: auto;" /&gt;

---

## Data manipulation with `dplyr` and `tidyr`

#### dplyr is a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges:

* `mutate()` adds new variables that are functions of existing variables
* `select()` picks variables based on their names.
* `filter()` picks cases based on their values.
* `summarise()` reduces multiple values down to a single summary.
* `arrange()` changes the ordering of the rows.
* `group_by()` perform any operation "by group".

#### Some examples :

.pull-left[

```r
summarise(iris,mean(Petal.Width))
```

```
##   mean(Petal.Width)
## 1          1.199333
```
]
.pull-right[

```r
summarise(group_by(iris,Species),mean(Petal.Width))
```

```
## # A tibble: 3 × 2
##   Species    `mean(Petal.Width)`
##   &lt;fct&gt;                    &lt;dbl&gt;
## 1 setosa                   0.246
## 2 versicolor               1.33 
## 3 virginica                2.03
```
]


---

##Pipes

__The pipe %&gt;%:__

* Come from the \textbf{magrittr} package by Stefan Milton Bache.
* Automatically loaded in tidyverse.
* Equivalent to `|` in `bash`


```bash
cat iris.tsv | cut -f5 | sed 's/^./\U&amp;/' | head
```

```
## Species
## Setosa
## Setosa
## Setosa
## Setosa
## Setosa
## Setosa
## Setosa
## Setosa
## Setosa
```


```r
read_tsv("iris.tsv",col_names = F) %&gt;% pull(5) %&gt;% str_to_title() %&gt;% head
```

```
## [1] "Species" "Setosa"  "Setosa"  "Setosa"  "Setosa"  "Setosa"
```

---

##Pipes vs no pipes : without pipe




```r
ex.dat &lt;- rnorm(n = 1000,mean = 5,sd=1)
sub.dat &lt;- sample(ex.dat,size = 100,replace=F)
hist(sub.dat)
```

&lt;img src="index_files/figure-html/histo1-1.svg" width="576" style="display: block; margin: auto;" /&gt;

---

##Pipes vs no pipes : without pipe




```r
hist(sample(rnorm(n = 1000,mean = 5,sd=1),size = 100,replace=F))
```

&lt;img src="index_files/figure-html/histo2-1.svg" width="576" style="display: block; margin: auto;" /&gt;

---

##Pipes vs no pipes : with pipe




```r
rnorm(n = 1000,mean = 5,sd=1) %&gt;%
    sample(size = 100,replace=F) %&gt;%
    hist()
```

&lt;img src="index_files/figure-html/histo3-1.svg" width="576" style="display: block; margin: auto;" /&gt;



---
## Prepare `iris` dataset for `ggplot2`

###iris dataset
&gt; The famous (Fisher’s or Anderson’s) iris data set gives the measurements in centimeters of the variables sepal length and width and petal length and width, respectively, for 50 flowers from each of 3 species of iris. The species are Iris setosa, versicolor, and virginica. (from ?iris)


&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;iris dataset&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; Sepal.Length &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sepal.Width &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Petal.Length &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Petal.Width &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Species &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4.7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4.6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---

.left-column[
## &lt;svg viewBox="0 0 640 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M255.03 261.65c6.25 6.25 16.38 6.25 22.63 0l11.31-11.31c6.25-6.25 6.25-16.38 0-22.63L253.25 192l35.71-35.72c6.25-6.25 6.25-16.38 0-22.63l-11.31-11.31c-6.25-6.25-16.38-6.25-22.63 0l-58.34 58.34c-6.25 6.25-6.25 16.38 0 22.63l58.35 58.34zm96.01-11.3l11.31 11.31c6.25 6.25 16.38 6.25 22.63 0l58.34-58.34c6.25-6.25 6.25-16.38 0-22.63l-58.34-58.34c-6.25-6.25-16.38-6.25-22.63 0l-11.31 11.31c-6.25 6.25-6.25 16.38 0 22.63L386.75 192l-35.71 35.72c-6.25 6.25-6.25 16.38 0 22.63zM624 416H381.54c-.74 19.81-14.71 32-32.74 32H288c-18.69 0-33.02-17.47-32.77-32H16c-8.8 0-16 7.2-16 16v16c0 35.2 28.8 64 64 64h512c35.2 0 64-28.8 64-64v-16c0-8.8-7.2-16-16-16zM576 48c0-26.4-21.6-48-48-48H112C85.6 0 64 21.6 64 48v336h512V48zm-64 272H128V64h384v256z"&gt;&lt;/path&gt;&lt;/svg&gt; Your turn
] 
.right-column[

1. Load the iris dataset from the `iris.tsv` file using `readr::read_tsv()`.
2. Create a new column called `Individual`, labelling each individual by a number with `dplyr::mutate()` and `dplyr::n()`.
3. Manipulate the table to lengthens data with `tidyr::pivot_longer()`, increasing the number of rows and decreasing the number of columns.
4. Use `tidyr::separate` to split the `Feature` column into two new columns: `Part` and `Metric`.
5. __Bonus__: try to do some basic statistics with `dplyr::group_by()` and `dplyr::summarise()`.
6. __Bonus__: Add descriptive metadata from `iris_metadata.tsv` with `dplyr::left_join()`.


]

.pull-left[
#### __Need some help ?__

* Try to look at the cheatsheets: https://www.rstudio.com/resources/cheatsheets/. 
* Take a look at the [wiki](https://github.com/rochevin/formation_ggplot2/wiki/Data-manipulation-with-Tidyverse)

]
.pull-right[

&lt;img src="index_files/figure-html/ggplot18-1.svg" width="300" style="display: block; margin: auto;" /&gt;


]

---
## Prepare `iris` dataset for `ggplot2`



```r
iris.tbl &lt;- readr::read_tsv("iris.tsv") %&gt;%
  dplyr::mutate(Individual = 1:dplyr::n()) %&gt;% 
  tidyr::pivot_longer(-Species:-Individual,names_to = "Type",values_to = "obs") %&gt;%
  tidyr::separate(Type,into = c("Part","Metric"),sep="\\.")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Species &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Individual &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Part &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Metric &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; obs &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sepal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Length &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sepal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Width &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Petal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Length &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Petal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Width &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sepal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Length &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sepal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Width &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Petal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Length &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.4 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Petal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Width &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sepal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Length &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sepal &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Width &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.2 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## Produce awesome plots using `ggplot2`

&lt;img src="index_files/figure-html/unnamed-chunk-25-1.svg" width="1008" style="display: block; margin: auto;" /&gt;



---



### The three key components of every ggplot2

* __data__: the dataset who's need to be plotted.
* __aesthetics__: aesthetics mapping between variables in the data (x,y,visuals properties, ...).
* __geoms__: one or more layers to render each observations.

.center[
&lt;img src="imgs/data-visualization_ggplot2.svg" width="100%" /&gt;

]


---

### The three key components of every ggplot2

.pull-left[




```r
ggplot(`data = iris.tbl`,
       `aes(x=Part,y=obs)`) 
```


* __data__: `data = iris`.
* __aesthetics__: `aes(x=Part,y=obs)`.

]
.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-28-1.svg" width="504" /&gt;



]


---

### The three key components of every ggplot2

.pull-left[




```r
ggplot(`data = iris.tbl`,
       `aes(x=Part,y=obs)`) +
  `geom_boxplot()`
```


* __data__: `data = iris`.
* __aesthetics__: `aes(x=Part,y=obs)`.
* __geoms__: `geom_boxplot()`.

]
.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-30-1.svg" width="504" /&gt;



]


---

### The three key components of every ggplot2

.pull-left[




```r
ggplot(`data = iris.tbl`,
       `aes(x=Part,y=obs,fill=Species)`) +
  `geom_boxplot()`
```


* __data__: `data = iris`.
* __aesthetics__: `aes(x=Part,y=obs,fill=Species)`.
* __geoms__: `geom_boxplot()`.

]
.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-32-1.svg" width="504" /&gt;



]


---

### The three key components of every ggplot2

.pull-left[




```r
ggplot(`data = iris.tbl`,
       `aes(x=Part,y=obs,color=Species)`) +
  `geom_boxplot()`
```


* __data__: `data = iris`.
* __aesthetics__: `aes(x=Part,y=obs,color=Species)`.
* __geoms__: `geom_boxplot()`.

]
.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-34-1.svg" width="504" /&gt;



]


---

### The three key components of every ggplot2

.pull-left[




```r
ggplot(`data = iris.tbl`,
       `aes(x=Part,y=obs,color=Species)`) +
  `geom_boxplot()` +
  facet_wrap(~Metric,scales="free_y")
```


* __data__: `data = iris`.
* __aesthetics__: `aes(x=Part,y=obs,color=Species)`.
* __geoms__: `geom_boxplot()`.
* __facet function__: `facet_wrap(~Metric,scales="free_y")`.

__Facetting__: 

* `facet_grid(~variable)` : Display all possibility even if some plots are __empty__.
* `facet_wrap(~variable)` : Display only the plots having actual values.


]
.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-36-1.svg" width="504" /&gt;



]


---

### The three key components of every ggplot2


.pull-left[

### Combining multiples `geom_`



```r
p &lt;- ggplot(`data = iris.tbl`,
       `aes(x=Part,y=obs,color=Species)`) +
  facet_wrap(Part~Metric,scales="free_y")

p &lt;- p +  `geom_boxplot(width=0.15,outlier.shape=NA)`
p &lt;- p +  `geom_violin(alpha=0.2)`
p &lt;- p +  `geom_jitter(width=0.15)`
```


* `geom_boxplot(width=0.15,outlier.shape=NA)`: display data as boxplot, without outliers.
* `geom_violin(alpha=0.2)`: display data density, on mirror (violin).
* `geom_jitter(width=0.15)`: display data as point, using some random variation to `x` (jitter).

]

.pull-right[
&lt;img src="imgs/ggdisplay.gif" width="100%" /&gt;

]

---

### Uses of aesthetics within `aes`


.pull-left[

#### aesthetics can be hardcoded



```r
ggplot(data = iris.tbl,
       aes(x=Part,y=obs)) +
    geom_boxplot(`fill = "grey40"`,
                     `col = "steelblue"`) +
  geom_jitter(`alpha=0.4`)
```

&lt;img src="index_files/figure-html/unnamed-chunk-40-1.svg" width="288" /&gt;

]

--

.pull-right[

#### Or included within `aes`


```r
ggplot(data = iris.tbl,
       aes(x=Part,y=obs,`col=Species`,`shape=Metric`)) +
    geom_boxplot() +
  geom_jitter(alpha=0.4)
```

&lt;img src="index_files/figure-html/unnamed-chunk-42-1.svg" width="288" /&gt;



]




---
### Uses of aesthetics within `aes`





```r
ggplot(data = iris.tbl,
       aes(x=Part,y=obs,`col=Species`,`shape=Metric`)) +
    geom_boxplot() +
  geom_jitter(alpha=0.4)
```

&lt;img src="index_files/figure-html/unnamed-chunk-44-1.svg" width="576" style="display: block; margin: auto;" /&gt;


---
### Uses of aesthetics within `aes`

`aes()` can be called within `ggplot` function or within each `geom_*`.


```r
ggplot(data = iris.tbl,
       aes(x=Part,y=obs)) +
    geom_boxplot() +
  geom_jitter(aes(`col=Species`,`shape=Metric`),alpha=0.4)
```

&lt;img src="index_files/figure-html/unnamed-chunk-46-1.svg" width="576" style="display: block; margin: auto;" /&gt;


---
### Uses of aesthetics within `aes`



```r
p_boxplot &lt;- ggplot(data = iris.tbl,
       aes(x=Part,y=obs)) +
    geom_boxplot() +
  geom_jitter(aes(`col=Species`,`shape=Metric`),alpha=0.4) +
  `facet_wrap(~Metric)`
p_boxplot
```

&lt;img src="index_files/figure-html/unnamed-chunk-48-1.svg" width="576" style="display: block; margin: auto;" /&gt;

Strength of `ggplot2`: Combining various aesthetics allow to display __multiples variable in one plot easily.__

---

### How to zoom/set axis with `ggplot2`

#### __Use `coord_cartesian` to zoom, not `xlim`, `ylim`, or `scale_*`__

.pull-left[

```r
p_boxplot_1 &lt;- p_boxplot + ylim(c(2,4))
```
]

.pull-right[

```r
p_boxplot_2 &lt;- p_boxplot +
  coord_cartesian(ylim=c(2,4))
```
]

&lt;img src="index_files/figure-html/unnamed-chunk-51-1.svg" width="1152" style="display: block; margin: auto;" /&gt;





---

### Graphical options


```r
p &lt;- iris.tbl  %&gt;% 
  ggplot(aes(x=Species,y=obs,color=Species,fill = after_scale(colorspace::lighten(color, .5)))) +
  geom_boxplot(width=0.15,outlier.shape=NA) +
  geom_violin(alpha=0.2) +
  geom_jitter(width=0.15)+
  facet_wrap(Part~Metric,scales="free_y",nrow=1) +
    scale_color_brewer(palette="Set1") #A new palette
print(p)
```

&lt;img src="index_files/figure-html/ggplot13-1.svg" width="1008" /&gt;


---

&lt;img src="index_files/figure-html/ggplot14-1.svg" width="1008" /&gt;


---

### Various `geom_*` for various aesthetic.

&lt;img src="index_files/figure-html/ggplot11-1.svg" width="1584" /&gt;


---

##Themes




.pull-left[

```r
p
```

&lt;img src="index_files/figure-html/unnamed-chunk-53-1.svg" width="576" /&gt;
]


.pull-right[

```r
p + theme_classic()
```

&lt;img src="index_files/figure-html/unnamed-chunk-54-1.svg" width="576" /&gt;
]

---

##Themes

&lt;img src="index_files/figure-html/ggplot15-1.svg" width="1584" /&gt;

---

##Themes

&lt;img src="index_files/figure-html/ggplot16-1.svg" width="1584" /&gt;


---

## A custom Theme

&lt;img src="index_files/figure-html/ggplot17-1.svg" width="1584" /&gt;


---

## Get, set, and modify the active theme with `theme_set()` and `theme_update()`

.pull-left[


```r
p
```

&lt;img src="index_files/figure-html/theme_display-1.svg" width="288" /&gt;

]
.pull-right[

```r
theme_set(theme_minimal(base_size=6))
theme_update(
  strip.background = element_rect(fill = "#636e72", colour = "#2d3436"), 
  panel.background = element_rect(fill = "#2d3436", colour = "#2d3436"), 
  strip.text = element_text(colour = "#dfe6e9")
)
p
```


&lt;img src="index_files/figure-html/theme_display2-1.svg" width="288" /&gt;

]

---

## Save your plot


.pull-left[
### Using `pdf()`, `png()`, `svg()`, ...

```r
pdf("myplot.pdf",height=4,width=4)
print(p)
dev.off()
```
]


.pull-right[
### Using `ggplot2::ggsave`

```r
ggplot2::ggsave("myplot.pdf",p,height=4,width=4)
```
]

* `height` and `width` are in inches for `pdf()`, but can be changed with `ggsave(units="px")`.
* `ggsave` will figure what format you want based on the file extension (".pdf").
* `dpi` parameter allow to change the plot resolution: "retina" (320), "print" (300), or "screen" (72).
---

.left-column[
## &lt;svg viewBox="0 0 640 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M255.03 261.65c6.25 6.25 16.38 6.25 22.63 0l11.31-11.31c6.25-6.25 6.25-16.38 0-22.63L253.25 192l35.71-35.72c6.25-6.25 6.25-16.38 0-22.63l-11.31-11.31c-6.25-6.25-16.38-6.25-22.63 0l-58.34 58.34c-6.25 6.25-6.25 16.38 0 22.63l58.35 58.34zm96.01-11.3l11.31 11.31c6.25 6.25 16.38 6.25 22.63 0l58.34-58.34c6.25-6.25 6.25-16.38 0-22.63l-58.34-58.34c-6.25-6.25-16.38-6.25-22.63 0l-11.31 11.31c-6.25 6.25-6.25 16.38 0 22.63L386.75 192l-35.71 35.72c-6.25 6.25-6.25 16.38 0 22.63zM624 416H381.54c-.74 19.81-14.71 32-32.74 32H288c-18.69 0-33.02-17.47-32.77-32H16c-8.8 0-16 7.2-16 16v16c0 35.2 28.8 64 64 64h512c35.2 0 64-28.8 64-64v-16c0-8.8-7.2-16-16-16zM576 48c0-26.4-21.6-48-48-48H112C85.6 0 64 21.6 64 48v336h512V48zm-64 272H128V64h384v256z"&gt;&lt;/path&gt;&lt;/svg&gt; Your turn
] 
.right-column[

1. Try a various combination of `geom_*` to represent the `iris` dataset:
  * discrete, continous.
  * discrete, discrete.
  * continous, continous.
  * continous.
2. Customize your plot using a different color palettes and themes. 
3. __Bonus__: Compute descriptive statistics using `dplyr::summarise()` or `ggplot2::stat_summary()`.


]

.pull-left[
#### __Need some help ?__

* Try to look at the ggplot2 cheatsheets: https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf. 
* Take a look at the [wiki](https://github.com/rochevin/formation_ggplot2/wiki/Produce-awesome-plots-using-ggplot2)

]
.pull-right[

&lt;img src="index_files/figure-html/ggplot19-1.svg" width="375" style="display: block; margin: auto;" /&gt;


]

---

## Enhance your plots using `ggplot2` best extensions

&lt;img src="index_files/figure-html/unnamed-chunk-59-1.svg" width="1008" style="display: block; margin: auto;" /&gt;

* Take a look at the gallery: https://exts.ggplot2.tidyverse.org/gallery/
* Or for a list of usefull ggplot2 packages/extensions: https://github.com/erikgahner/awesome-ggplot2


---

## Enhance your plots using `ggplot2` best extensions

### A best-of:

* {[patchwork](https://patchwork.data-imaginist.com/)}: Combine/Assemble ggplots.
* {[ggforce](https://ggforce.data-imaginist.com/)}: Provide missing functionality to `ggplot2`.
* {[ggtext](https://wilkelab.org/ggtext/)}: Improved text rendering support for ggplot2.

### Interactive packages

* {[ggedit](https://github.com/yonicd/ggedit)}: Interactively edit ggplot layers, scales and themes aesthetics.
* {[esquisse](https://github.com/dreamRs/esquisse)}: Interactively explore your data by visualizing it with the ggplot2 package.

### Other useful packages

* Themes:  {[ggthemr](https://github.com/Mikata-Project/ggthemr)} and {[ggthemes](https://jrnold.github.io/ggthemes/reference/index.html)}.
* Colors: {[MetBrewer](https://github.com/BlakeRMills/MetBrewer/tree/main)}.
* Put statistics on `ggplot2`: {[ggpubr](https://rpkgs.datanovia.com/ggpubr/)} and {[ggstatsplot](https://github.com/IndrajeetPatil/ggstatsplot)}.




---

### `patchwork`




```r
p1 &lt;- iris.tbl %&gt;% 
  ggplot(aes(x=obs,col = Species,fill=after_scale(colorspace::lighten(color, .5)))) +
  geom_density() + facet_grid(Metric~Part)
p2 &lt;- iris.tbl %&gt;% 
  ggplot(aes(x=Species,y=obs,col = Species,fill=after_scale(colorspace::lighten(color, .5)))) +
  geom_boxplot() + facet_grid(Metric~Part)

require(patchwork)
p1 + p2
```

&lt;img src="index_files/figure-html/unnamed-chunk-61-1.svg" width="864" style="display: block; margin: auto;" /&gt;

---

### `patchwork`


```r
p3 &lt;- iris.tbl %&gt;% ggplot(aes(x=Species,y=obs,col = Part,fill=after_scale(colorspace::lighten(color, .5)))) + geom_bar(position="dodge",stat = "summary", fun = "mean") +
  facet_wrap(~Metric,scales="free_y")

patchwork &lt;- (p1 | p2) / p3 
patchwork + 
  plot_layout(guides = "collect") +
  plot_annotation(tag_levels = 'A')  &amp; theme(legend.position = "bottom") 
```

&lt;img src="index_files/figure-html/unnamed-chunk-62-1.svg" width="864" style="display: block; margin: auto;" /&gt;

---

### `patchwork`

#### Useful commands:

* Combine plots with `+`, `|` or `/`.
* Affect all plots with `&amp;`: `(p1 | p2) / p3 &amp; theme(legend.position="bottom")`.
* Control the grid with `plot_layout()`.
* Add annotation and style with `plot_annotation()`.
* Insert a plot inside another with `inset_element()`.
* Add blank area with `plot_spacer()`.


---
### `ggforce`

A very complete package wich add a lot of missing features. Check the full list at https://ggforce.data-imaginist.com/reference/index.html.


* `facet_zoom()`: Create a zoom facet for a plot.
* `facet_matrix()`: Allow to put differents columns into different rows and columns in a grid of panels.
* `geom_mark_*`: Graphical annotation of data.


---

### `ggforce::facet_zoom()`


```r
require(ggforce)
ggplot(iris, aes(Petal.Length, Petal.Width, colour = Species)) +
  geom_point() +
  facet_zoom(xy = Species == "versicolor")
```

&lt;img src="index_files/figure-html/unnamed-chunk-63-1.svg" width="864" style="display: block; margin: auto;" /&gt;


---

### `ggforce::facet_zoom()`


```r
ggplot(iris, aes(Petal.Length, Petal.Width, colour = Species)) +
  geom_point() +
  facet_zoom(xlim = c(2, 4))
```

&lt;img src="index_files/figure-html/unnamed-chunk-64-1.svg" width="864" style="display: block; margin: auto;" /&gt;

---

### `ggforce::facet_zoom()` for my zooming issue


```r
ggplot(data = filter(iris.tbl,Metric == "Width"),
                    aes(x=Part,y=obs)) +
    geom_boxplot(outlier.shape = NA) +
    geom_jitter(aes(col=Species,shape=Metric),alpha=0.4) + theme(legend.position ="bottom") +
    facet_zoom(ylim = c(2, 4))
```

&lt;img src="index_files/figure-html/unnamed-chunk-65-1.svg" width="864" style="display: block; margin: auto;" /&gt;


---

### `ggforce::facet_matrix()`



```r
iris %&gt;% ggplot(aes(col=Species,fill=Species)) +
  geom_autopoint() +
  geom_autodensity() +
  facet_matrix(vars(-Species),layer.diag = 2)
```

&lt;img src="index_files/figure-html/unnamed-chunk-66-1.svg" width="864" style="display: block; margin: auto;" /&gt;

---

### `ggforce::facet_matrix()`



```r
iris %&gt;% pivot_longer(-Species) %&gt;% 
  ggplot(aes(x=Species,y=value,fill=Species)) +
  geom_boxplot() +
  ggforce::facet_col(~name)
```

&lt;img src="index_files/figure-html/unnamed-chunk-67-1.svg" width="864" style="display: block; margin: auto;" /&gt;

---

### `ggforce::facet_matrix()`



```r
iris %&gt;% ggplot() +
  geom_boxplot(aes(x = .panel_x, y = .panel_y, fill=Species)) +
  facet_matrix(rows = vars(-Species),cols = vars(Species))
```

&lt;img src="index_files/figure-html/unnamed-chunk-68-1.svg" width="864" style="display: block; margin: auto;" /&gt;


---

### `ggforce::geom_mark_*()`


```r
ggplot(iris, aes(Petal.Length, Petal.Width)) +
  geom_mark_hull(aes(fill = Species, label = Species)) +
  geom_point()
```

&lt;img src="index_files/figure-html/unnamed-chunk-69-1.svg" width="864" style="display: block; margin: auto;" /&gt;


---
### `ggtext`

#### `ggtext`: Improved text rendering support for ggplot2 by adding __Markdown__ and __html__ syntax.


.pull-left[

```r
require(ggtext)
labels &lt;- c(
  setosa = "&lt;img src='imgs/setosa.png'
    width='80' /&gt;",
  virginica = "&lt;img src='imgs/virginica.png'
    width='80' /&gt;",
  versicolor = "&lt;img src='imgs/versicolor.png'
    width='80' /&gt;"
)

p3 +
  scale_x_discrete(
    name = NULL,
    labels = labels
  ) +
  theme(
    axis.text.x = `element_markdown()`
  )
```
]

.pull-right[
&lt;img src="index_files/figure-html/unnamed-chunk-71-1.svg" width="720" style="display: block; margin: auto;" /&gt;
]

---

#### `ggtext`: __Bold__, _italic_ and &lt;span style='color:red'&gt;color&lt;/span&gt; to `ggplot2`

.pull-left[

```r
iris.tbl %&gt;%
  mutate(my_color = case_when( 
    Species == "setosa" ~ "green", 
    Species == "virginica" ~ "blue", 
    Species == "versicolor" ~ "red", 
  )) %&gt;%  
  `mutate(Species = glue::glue("&lt;span style = 'color:{my_color};'&gt;{Species}&lt;/span&gt;"))` %&gt;%
  `mutate(Feature = glue::glue("**{Part}** (*{Metric}*)"))` %&gt;% 
  ggplot(aes(x=Species,y=obs,col = Feature,fill=after_scale(colorspace::lighten(color, .5)))) +
  geom_bar(position="dodge",stat = "summary", fun = "mean") +
  coord_flip() +
  theme(
    `axis.text.y = element_markdown()`,
    `legend.text = element_markdown()`
  ) 
```
]

.pull-right[
&lt;img src="index_files/figure-html/unnamed-chunk-73-1.svg" width="720" style="display: block; margin: auto;" /&gt;
]


---

.left-column[
## &lt;svg viewBox="0 0 640 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M255.03 261.65c6.25 6.25 16.38 6.25 22.63 0l11.31-11.31c6.25-6.25 6.25-16.38 0-22.63L253.25 192l35.71-35.72c6.25-6.25 6.25-16.38 0-22.63l-11.31-11.31c-6.25-6.25-16.38-6.25-22.63 0l-58.34 58.34c-6.25 6.25-6.25 16.38 0 22.63l58.35 58.34zm96.01-11.3l11.31 11.31c6.25 6.25 16.38 6.25 22.63 0l58.34-58.34c6.25-6.25 6.25-16.38 0-22.63l-58.34-58.34c-6.25-6.25-16.38-6.25-22.63 0l-11.31 11.31c-6.25 6.25-6.25 16.38 0 22.63L386.75 192l-35.71 35.72c-6.25 6.25-6.25 16.38 0 22.63zM624 416H381.54c-.74 19.81-14.71 32-32.74 32H288c-18.69 0-33.02-17.47-32.77-32H16c-8.8 0-16 7.2-16 16v16c0 35.2 28.8 64 64 64h512c35.2 0 64-28.8 64-64v-16c0-8.8-7.2-16-16-16zM576 48c0-26.4-21.6-48-48-48H112C85.6 0 64 21.6 64 48v336h512V48zm-64 272H128V64h384v256z"&gt;&lt;/path&gt;&lt;/svg&gt; Your turn
] 
.right-column[

1. Assemble the plots you did previously using `patchwork`.
2. Try some functions from `ggforce`.
3. __Bonus__: Enhance your plots using `ggtext`.

]

.pull-left[

]
.pull-right[

&lt;img src="index_files/figure-html/unnamed-chunk-74-1.svg" width="300" style="display: block; margin: auto;" /&gt;


]


---

.left-column[
## &lt;svg viewBox="0 0 640 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M255.03 261.65c6.25 6.25 16.38 6.25 22.63 0l11.31-11.31c6.25-6.25 6.25-16.38 0-22.63L253.25 192l35.71-35.72c6.25-6.25 6.25-16.38 0-22.63l-11.31-11.31c-6.25-6.25-16.38-6.25-22.63 0l-58.34 58.34c-6.25 6.25-6.25 16.38 0 22.63l58.35 58.34zm96.01-11.3l11.31 11.31c6.25 6.25 16.38 6.25 22.63 0l58.34-58.34c6.25-6.25 6.25-16.38 0-22.63l-58.34-58.34c-6.25-6.25-16.38-6.25-22.63 0l-11.31 11.31c-6.25 6.25-6.25 16.38 0 22.63L386.75 192l-35.71 35.72c-6.25 6.25-6.25 16.38 0 22.63zM624 416H381.54c-.74 19.81-14.71 32-32.74 32H288c-18.69 0-33.02-17.47-32.77-32H16c-8.8 0-16 7.2-16 16v16c0 35.2 28.8 64 64 64h512c35.2 0 64-28.8 64-64v-16c0-8.8-7.2-16-16-16zM576 48c0-26.4-21.6-48-48-48H112C85.6 0 64 21.6 64 48v336h512V48zm-64 272H128V64h384v256z"&gt;&lt;/path&gt;&lt;/svg&gt; Your turn
] 
.right-column[

1. Load the data from the `DE_result_edgeR_1_0.05_CvsC_OHT_table.tsv` file.
2. do a scatterplot between `logFC` and `-log10(p.adj)` (It's called a volcano plot).
  * You can use `?geom_hline` and `?geom_vline` to vizualise the treshold you want.
3. Classify the genes using the fold change (`logFC`) and the p-value (`p.adj`) with 3 class: `Upregulated`, `Downregulated` and `None`.
  * `Upregulated` mean that the expression increase after treatment `logFC &gt; 1`.
  * `Downregulated` mean that the expression decrease after treatment `logFC &lt; -1`.
  * `None` mean that the changes are not significant (`p.adj&gt;=0.05`).
  * You can use any treshold you want but I'll take `p.adj&lt; 0.05` and `abs(logFC) &gt; 1`.
4. Annotate the number of genes by category.
5. Build a specific color code by annotation to display on the plot and on the legend.
  * Try to associate a color with a class with `mutate` and `case_when`.
  * You can use `ggtext` to add color to axis/label.
  * And `scale_color_identity` to match the color you want.
6. Label genes top of their respective category (need `ggrepel` package).
7. Enhance your plot using a custom theme and by adding title/subtitle ...

]

.pull-left[
#### __Need some help ?__

* Try to look at the cheatsheets: https://www.rstudio.com/resources/cheatsheets/. 
* Take a look at the [wiki](https://github.com/rochevin/formation_ggplot2/wiki/Produce-awesome-plots-using-ggplot2#solution-for-differential-expression-analysis)

]
.pull-right[

&lt;img src="index_files/figure-html/ggplot25-1.svg" width="300" style="display: block; margin: auto;" /&gt;


]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
